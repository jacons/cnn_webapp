<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/style.css">
    <script src="../static/script.js"></script>
    <title>CNN Trainer</title>
</head>
<body class="bg-light">
<!-- Navbar -->
<nav class="navbar navbar-light bg-white shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand d-flex align-items-center" href="#">
            <img alt="Logo" class="style_logo me-2" height="40" src="../static/imgs/logo.png">
            <span class="fw-bold text-primary">CNN Car Classifier</span>
        </a>
    </div>
</nav>

<!-- Parameters -->
<div class="container my-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white fw-bold">
            ResNet-18 Parameters
        </div>
        <div class="card-body">
        <form action="/training" method="POST" id="trainForm">
            <div class="row g-4">
                <!-- Dataset Parameters -->
                <div class="col-md-4 border-end">
                    <h6 class="text-secondary mb-3">Dataset</h6>
                    <div class="mb-3">
                        <label class="form-label">Output classes</label>
                        <input class="form-control" name="num_classes" required type="number" value="196">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Dataset folder</label>
                        <input class="form-control" list="dataset_list" name="dataset_name"
                               value="{{ dataset_list[0] }}">
                        <datalist id="dataset_list">
                            {% for k in dataset_list %}
                            <option value="{{ k }}"></option>
                            {% endfor %}
                        </datalist>
                    </div>
                    <h6 class="text-secondary mt-4 mb-3">Model</h6>
                    <div class="mb-3">
                        <label class="form-label">Pretrained</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="pretrained" value="True" checked>
                            <label class="form-check-label">Yes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" name="pretrained" type="radio" value="False">
                            <label class="form-check-label">No</label>
                        </div>
                    </div>
                </div>

                <!-- Optimization Parameters -->
                <div class="col-md-4 border-end">
                    <h6 class="text-secondary mb-3">Optimization</h6>
                    <div class="mb-3">
                        <label class="form-label">Optimizer</label>
                        <input class="form-control" list="optimizer_list" name="optimizer" value="Adam">
                        <datalist id="optimizer_list">
                            <option value="Adam">
                            <option value="SGD">
                            <option value="Averaged Stochastic Gradient Descent">
                            <option value="L-BFGS">
                        </datalist>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Learning rate</label>
                        <input class="form-control" name="lr" type="text" value="0.001">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Batch size</label>
                        <input class="form-control" name="batch_size" required type="number" value="64">
                    </div>
                </div>

                <!-- Generic Parameters -->
                <div class="col-md-4">
                    <h6 class="text-secondary mb-3">Training</h6>
                    <div class="mb-3">
                        <label class="form-label">Epochs</label>
                        <input class="form-control" name="epochs" type="text" value="100">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Patience (early stopping)</label>
                        <input class="form-control" name="early_stopping_patience" type="number" value="5">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">GPU</label>
                        <input class="form-control" list="gpu_list" name="gpu_engine" value="{{gpu_list[0]}}">
                        <datalist id="gpu_list">
                            {% for k in gpu_list %}
                            <option value="{{ k }}"></option>
                            {% endfor %}
                        </datalist>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Save results in</label>
                        <input class="form-control" name="output_folder_name" type="text" value="model1">
                    </div>
                </div>
            </div>

            <!-- Submit -->
            <div class="text-center mt-4">
                <input name="action" type="hidden" value="training">
                <button class="btn btn-lg btn-primary px-4" id="trainBtn" type="submit">ðŸš€ Train</button>
            </div>
        </form>
        </div>
    </div>
</div>

<!-- Progress -->
<div class="container mb-5">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white fw-bold">Progress</div>
        <div class="card-body">
            <div class="progress mb-3" style="height: 25px;">
                <div aria-valuemax="100" aria-valuemin="0" class="progress-bar progress-bar-striped progress-bar-animated"
                     id="bar" role="progressbar" style="width: 0%;"></div>
        </div>
            <div class="text-center mb-3">
                <span class="fw-bold" id="status">-</span>
            </div>

            <!-- Training Log -->
            <h6 class="text-secondary mb-3">Training Log</h6>
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <tbody>
                    <tr>
                        <th>Training loss (mean)</th>
                        <td id="tr_loss_mean">0.456</td>
                        <th>Training loss (std)</th>
                        <td id="tr_loss_std">0.124</td>
                    </tr>
                    <tr>
                        <th>Validation loss (mean)</th>
                        <td id="vl_loss_mean">0.456</td>
                        <th>Validation loss (std)</th>
                        <td id="vl_loss_std">0.124</td>
                    </tr>
                    <tr>
                        <th>Validation F1 (mean)</th>
                        <td id="vl_f1">0.456</td>
                        <th>Validation Accuracy (mean)</th>
                        <td id="vl_acc">0.124</td>
                    </tr>
                    <tr>
                        <th>Epoch</th>
                        <td id="epoch">45</td>
                        <th>Batch</th>
                        <td id="batch">34</td>
                    </tr>
                    <tr>
                        <th>Time start</th>
                        <td id="time_start">12:34</td>
                        <th>Time elapsed</th>
                        <td id="time_elapsed">12:35</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById("trainForm").addEventListener("submit", function (e) {
        e.preventDefault();
        const trainBtn = document.getElementById("trainBtn");
        trainBtn.disabled = true;
        trainBtn.innerText = "â³ Training...";
        const formData = new FormData(this);
        fetch("/training", {method: "POST", body: formData})
            .then(() => {
                setTimeout(updateProgress, 500);
            });
    });
</script>
</body>
</html>
